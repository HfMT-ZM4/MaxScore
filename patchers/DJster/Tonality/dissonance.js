//JavaScript program for the calculation of sensory dissonance based on Bill Sethares' BASIC programinlets = 2;outlets = 1;var amp = new Array();var reference_f = new Array();var reference_a = new Array();var reference_n = 0;var interval_f = new Array();var interval_a = new Array();var interval_n = 0;var dstar  = 0.24;var s1 = 0.0207;var s2 = 19.96;var c1 = 5.;var c2 = -5.;var a1 = -3.51;var a2 = -5.75;var index  = -1;var n = 6;var startint = 1;var endint = 2.3;var inc = 0.01;//amp[1]=10; amp[2]=8.8; amp[3]=7.7;//amp[4]=6.8; amp[5]=6; amp[6]=5.3;//loop through all intervals from startint to endint function anything(){var inl = inlet;if(inl==0){var interval = arrayfromargs(messagename,arguments);interval_n = interval.lengthidx = 1;for(i = 0; i <= interval_n - 1; i++){if(i % 2==0){interval_f[idx] =interval[i];//post(interval_f[idx]);//post();}else{interval_a[idx] = 10. * interval[i];//post(interval_a[idx]);//post();idx = idx + 1;}}if (reference_n){calculate();}}else{var reference = arrayfromargs(messagename,arguments);reference_n = reference.length	idx = 1;for(i = 0; i <= reference_n - 1; i++){if(i % 2==0){reference_f[idx] =reference[i];}else{reference_a[idx] = 10. * reference[i];idx = idx + 1;}}}}function calculate(){d = 0;for(i = 1; i <= reference_n /2; i++){for(j = 1; j <= interval_n / 2; j++){lij = Math.min(reference_a[i], interval_a[j]);if(interval_f[j]<reference_f[i]) {fmin = interval_f[j];}else {fmin = reference_f[i];}s = dstar/(s1*fmin+s2);fdif = Math.abs(interval_f[j]-reference_f[i]);arg1 = a1*s*fdif;arg2 = a2*s*fdif;if(arg1<-88){exp1 = 0;}else {exp1 = Math.exp(arg1);}if(arg2<-88){exp2 = 0;}else {exp2 = Math.exp(arg2);}dnew = lij*(c1*exp1+c2*exp2);d = d + dnew;}}outlet(0, d);}