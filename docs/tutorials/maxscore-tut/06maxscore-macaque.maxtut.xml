<?xml version='1.0' encoding='UTF-8'?>

<?xml-stylesheet href="./_c74_tut.xsl" type="text/xsl"?>

<chapter name="Macaque: Spectral Transcription">
<previous name="12maxscore-compatibility">MaxScore: Compatibility</previous>
<!--
<next name="06maxscore-macaque">Macaque</next>
-->
<parent name="00maxscore-00index">MaxScore: Table of Contents</parent>

<h1>Macaque: Spectral Transcription</h1>

<p>Macaque is an application for conversion of SDIF files (generated by applications such as SPEAR or AudioSculpt) into standard music notation.</p>
<p>Click on "Macaque Environment" button in the MaxScore Overview patch to open Macaque and its peripheral components (first open the latter by choosing Overview from the Max>Extras>MaxScore menu)</p>

<illustration><img src="images/Macaque/Macaque-image1.png" width="600" /></illustration>
<p><i>The Macaque Environment</i></p>

<illustration><img src="images/Macaque/Macaque-image2.png"/></illustration>
<p style="text-align: center;"><i>Macaque has three panes two of which can be collapsed.</i></p>

<h2>The panes</h2>
<p>Macaque is using MaxScore to generate and display:</p>
<ol>
<li>Transcription of sinusoidal tracks (partial tracks)</li>
<li>Display of the harmonic content for selected frames</li>
<li>Segmentation editor displaying the sum-of-amplitude and centroid curves. Segmentation is performed with markers which can either be set manually or imported from AudioSculpt.</li>
</ol>
<p><br/><techdetail><b>Macaque has three panes of which the top one offers four views: Main, Curves, Speed, Preferences</b></techdetail></p>
<p>The <i>Main view</i> shows the partial tracks and displays a number of buttons which are more or less self-explanatory. An interesting feature is the ability to sync-play the SDIF file with the transcribed score.</p>

<illustration><img src="images/Macaque/Macaque-image5-Curves.png" width="600"/></illustration>
<illustration><img src="images/Macaque/Macaque-image6-Speed.png" width="600"/></illustration>
<p><i>A graphical function editor, visible in Curves view, allows the time-dependent manipulation of various parameters such as amplitude, temporal trajectory, spectral stretching and transposition, while a separate tempo curve can be set in Speed view.</i></p>
<p>N.B. The top pane in Main view and the bottom pane both feature linear (frequency and amplitude) and logarithmic (pitch and loudness) display modes. Use the View menu to make your choice.</p>

<h2>Preferences</h2>
<p><techdetail><b>In Preferences, a number of parameters can be set, for which the following explanations serves as a brief introduction:</b></techdetail></p>
<illustration><img src="images/Macaque/Macaque-image7-Preferences.png" width="600"/></illustration>

<h3>MIDIfication:</h3>
<p><b>Number of relevant</b> tracks lets you reduce the track number that MIDIfication takes into consideration. Can speed up computation and has a certain impact on the result.</p>
<p><b>Pitch tolerance</b> refers to the vertical granularity of the transcription. With a value of 100 cent, pitches that subsequently fall into this interval are considered to belong to the same MIDI track and are therefore sustained. If you want to transcribe a glissando make this value as small as possible, otherwise the glissando might only appear as a long sustained note.</p>
<p><b>MIDI Velocity Tolerance</b> has an analog function: If, within a MIDI track, velocity rises beyond a certain value, create a separate note event, otherwise assume a sustained note.</p>
<p><b>Velocity</b> (First value/average): Before assigning partial tracks to MIDI tracks Macaque first calculates the relevance (its rank) of a partial track by looking at its velocity. Depending on the nature of the sound (exponentially decaying or sustained), one would look either at the first velocity for a given partial track or at its average value.</p>
<p><b>Velocity 0 equals dB:</b> This dB value constitutes a threshold under which no note-on event is created.</p>
<p><b>Attractor Size:</b> Macaque is performing a partial tracking analysis of its own kind: Since the maximum number of MIDI tracks is 32, the algorithm tries to merges partial tracks with pitches that fall within the interval given by attractor size, provided that there is a gap in the MIDI track, or splits a track if it contains leaps that are larger than Attractor Size.</p>
<h3>Granularity:</h3>
<p><b>Synthesis:</b> Partial tracks are read and played back at the rate given by the time interval</p>
<p><b>MIDIfication with ...:</b> MIDI tracks are quantized according to the given time interval. The menu lets you set the subdivision of a beat whose tempo is given in the bottom right hand corner.</p>
<h3>Processing:</h3>
<p>Filter out amplitudes below: Filter individual partials if they fall below a given threshold. This will be applied both to playback and MIDIfication</p>
<h3>Transcription:</h3>
<p><b>Microtones</b>: Use microtonal accidentals if checked<br/><b>Transcribe Dynamics</b>: Add dynamic markings if checked; repeated dynamics will be ignored up to a rest or beginning of a new track.</p>
<h3>Tempo:</h3>
<p>The tempo to be displayed in the score.</p>
<h3>Time Signature:</h3>
<p>The time signature to be displayed in the score.</p>
<h3>Spectral Display Label:</h3>
<p>Type of label assigned to the pitches of the spectrum pane (center). Choose between Hz, MIDI cents and cent deviations.</p>
<h3>Beat division scheme:</h3>
<p>Subdivisions of a beat considered by the MaxScore transcriber. See MaxScore help file for further explanation.</p>
<h3>Presets:</h3>
<p>There are 6 slots to which presets can be stored. They can also be written to and read from file via the Save and Open buttons.</p>

<h2>Working with SDIF files</h2>
<h3>Preparing SDIF files in SPEAR:</h3>
<p>When importing SDIF files from SPEAR, make sure that they only contain significant information, i.e. you may want to set a number of threshold to not overload the SDIF with partial tracks that are either too soft, too short or too high to be performed by an instrument, if this is the ultimate goal.</p>
<p>SPEAR possesses a number of options to clean up an analysis file, but you can also manually select and delete dispensable tracks.</p>
<h3>Opening a file:</h3>
<p>Click the "open SDIF File..." button and select an SDIF file in a valid file format (1TRC), e.g. the file GLocke-mono which is an analysis of a bell and can be found in Max 8/Packages/MaxScore/patchers/Macaque/lib. Depending on file size this may take a while. While it is recommended to work with files no longer than 3 - 5 minutes, Macaque also supports longer files, but with certain drawbacks.</p>
<h3>Cursor:</h3>
<p>To display the spectral content at a particular time in the file, place the cursor within the top or bottom panes. The partials will now be shown in the middle pane in eighth-tone resolution.</p>
<p>Use shift-left arrow oder shift-right arrow to move the cursor horizontally and press down-array to play the spectrum as a single chord or up-array to arpeggiate the chord.</p>
<h3>Selection:</h3>
<p>Macaque will playback and transcribe selected areas. Select the desired area by dragging the mouse horizontally or use shift-a to select the entire file. Selections can be made in the top and bottom panes. In case, you have added markers in the bottom pane, it might be useful to make the selection in the top pane as to not accidentally move a marker.</p>
<p>When the file or a selection thereof is played back, it is automatically being recorded to a buffer from which it can be saved as an audio file. This is of particular interest when transforms are being applied (see section on curves).</p>

<h3>Parameter curves:</h3>
<p>In Curves view you will a drop-down menu with five parameters whose values can be changed in the break-point function editor. Except for Trajectory, the result of these changes are immediately visible in the Main view: Amplitude changes affect the color of the partial tracks, Reference Frequency and Transposition move them up or down, and Spectral Stretching moves them either closer together or farther apart.</p>
<p>Spectral stretching is being calculated using a formula developed by Max Mathews and John Pierce (see <link>http://articles.ircam.fr/textes/Mathews80b/</link>). In case the partial number is not know for a particular partial track, a Reference Frequency can by given instead (default = 55 Hz). Changing Reference Frequency has the same effect as transposing partials, though.</p>
<p>The Trajectory parameter affect the route playback takes through the SDIF file. Reversing the parameter with the second drop-down menu will show a descending line: the cursor will now play from the end to the beginning, rather than the other way around.</p>
<p>These parameter changes also determine the how transcription is performed. Change the curves and witness how the resulting score changes in response to it.</p>
<h2>Transcription</h2>

<h3>Partial Tracks:</h3>
<p>Before transcribing the partials tracks visible in the top pane and possibly collapse the number of tracks intelligently into an appropriate number of staves, first make your choices (quantization, time signature, tempo, etc) in the Preferences pane and apply the desired changes in curves editor. Then press the Transcribe button.</p>
<p>To view the score and further edit it, first connect an instance of the MaxScore Editor, the MaxScore object rendering to either maxscore.bcanvas or maxscore.canvas, or maxscore.icanvas to the outlets labeled "m" and "x"</p>
<illustration><img src="images/Macaque/Macaque-image4-score.png"/></illustration>
<p style="text-align:center"><i>Transcription of partial tracks for the Glocke-mono.sdif file.</i></p>
<p>The following screenshot displays the partial tracks for the same file after applying a time-dependent spectral-stretching transform (from 1.59 to 2.0). The partial tracks appear compressed at the beginning and will morph to the original spacing at the end.</p>
<illustration><img src="images/Macaque/Macaque-image10-PartialTracksStretched.png"/></illustration>
<h3>Spectral Notation:</h3>
<illustration><img src="images/Macaque/Macaque-image8-SpectralDisplay.png"/></illustration>
<p>The Spectral Notation pane shows the spectral content for a frame defined by the cursor position, each partial with a Hz label. The pitches can be saved in various formats as well as copied and pasted to MaxScore.</p>
<p><i>Display of spectral content at the time defined by the cursor position.</i></p>
<h3>Segmentation Editor:</h3>
<illustration><img src="images/Macaque/Macaque-image9-Markup.png"/></illustration>
<p>The Segmentation editor permits placing markers for rhythmically accurate transcription of the SDIF file. For this, click anywhere inside the bottom pane and press <i>m</i> for a on-marker (orange, indicating where an event should start) or <i>shift-m</i> for an off-marker (purple, indicating where an event should stops and a rest should appear). The amplitude (green) and the centroid (cyan) curves should help you find meaningful time points to set the markers.</p>
<p>Segmentation editor features the following transcription modes:</p>
<ol>
<li>Rhythm</li>
<li>Fundamental</li>
<li>Lowest Pitch</li>
<li>Salient Pitch</li>
<li>Centroid</li>
<li>Centroid Nearest Neighbor</li>
<li>Chord</li>
</ol>
<p>Depending on the mode of your choice, Macaque will set the pitch(es) for each event (time between two markers) by performing a search inside the SDIF file and, if necessary applying some calculations such as in the case of Fundamental and Centroid. For example, when the mode is set to Salient Pitch, Macaque looks through all frames within two markers, selects the frame with the highest amplitude and displays its most salient partial as pitch.</p>
<illustration><img src="images/Macaque/Macaque-image3_1-transcribeRhythm.png"/></illustration>
<p><i>Transcribed rhythm according the mark-up performed on the SDIF file</i></p>
<illustration><img src="images/Macaque/Macaque-image3_2-transcribeSalientPitch.png"/></illustration>
<p><i>Same mark-up in Salient mode</i></p>
<illustration><img src="images/Macaque/Macaque-image3_3-transcribeSalientPitchStretched.png"/></illustration>
<p><i>Same mark-up in Salient mode and a spectral-stretching transform</i></p>

<p>Further reading: <link>http://georghajdu.de/wp-content/uploads/Macaque-–-A-tool-for-spectral-processing-and-transcription.pdf</link></p>
-->
</chapter>
